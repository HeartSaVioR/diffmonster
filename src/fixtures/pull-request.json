{
  "url": "https://api.github.com/repos/line/armeria/pulls/507",
  "id": 116954235,
  "html_url": "https://github.com/line/armeria/pull/507",
  "diff_url": "https://github.com/line/armeria/pull/507.diff",
  "patch_url": "https://github.com/line/armeria/pull/507.patch",
  "issue_url": "https://api.github.com/repos/line/armeria/issues/507",
  "number": 507,
  "state": "open",
  "locked": false,
  "title": "More convenient deferred construction of RpcResponse and HttpResponse",
  "user": {
    "login": "trustin",
    "id": 173918,
    "avatar_url": "https://avatars3.githubusercontent.com/u/173918?v=3",
    "gravatar_id": "",
    "url": "https://api.github.com/users/trustin",
    "html_url": "https://github.com/trustin",
    "followers_url": "https://api.github.com/users/trustin/followers",
    "following_url": "https://api.github.com/users/trustin/following{/other_user}",
    "gists_url": "https://api.github.com/users/trustin/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/trustin/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/trustin/subscriptions",
    "organizations_url": "https://api.github.com/users/trustin/orgs",
    "repos_url": "https://api.github.com/users/trustin/repos",
    "events_url": "https://api.github.com/users/trustin/events{/privacy}",
    "received_events_url": "https://api.github.com/users/trustin/received_events",
    "type": "User",
    "site_admin": false
  },
  "body": "Motivation:\r\n\r\nA user often ends up with quite verbose code when he or she wants to\r\ndefer the construction of a RpcResponse or an HttpResponse. For example:\r\n\r\n    // RpcResponse\r\n    DefaultRpcResponse res = new DefaultRpcResponse();\r\n    CompletableFuture<Object> future = doAsync();\r\n    future.whenComplete((value, cause) -> {\r\n        if (cause != null) {\r\n            res.completeExceptionally(cause);\r\n        } else {\r\n            res.complete(value);\r\n        }\r\n    });\r\n    return res;\r\n\r\n    // HttpResponse\r\n    DeferredHttpResponse res = new DeferredHttpResponse();\r\n    CompletableFuture<HttpResponse> future = doAsync();\r\n    future.whenComplete((actualRes, cause) -> {\r\n        if (cause != null) {\r\n            res.close(cause);\r\n        } else {\r\n            res.delegate(actualRes);\r\n        }\r\n    });\r\n    return res;\r\n\r\nThis pull request simplifies the code above into:\r\n\r\n    // RpcResponse\r\n    return RpcResponse.from(doAsync());\r\n\r\n    // HttpResponse\r\n    return HttpResponse.from(doAsync());\r\n\r\nModifications:\r\n\r\n- Add RpcResponse.from(CompletionStage<?>)\r\n- Add RpcResponseTest to test from()\r\n- Add HttpResponse.from(CompletionStage<? extends HttpResponse>)\r\n- Use HttpResponse.from() where possible\r\n- Improve HttpAuthServiceTest so that the use of HttpResponse.from() is\r\n  tested better\r\n- Miscellaneous:\r\n  - Add RpcResponse.join() and getNow()\r\n  - Add HttpResponse.ofFailed(Throwable)\r\n  - Fix the broken example in DeferredHttpResponse\r\n  - Add Exceptions.throwUnsafely()\r\n  - Rename AuthServiceTest to HttpAuthServiceTest\r\n\r\nResult:\r\n\r\n- Better user experience",
  "created_at": "2017-04-21T10:17:11Z",
  "updated_at": "2017-04-22T04:40:34Z",
  "closed_at": null,
  "merged_at": null,
  "merge_commit_sha": "4af8f143263335cae3ef82e20b6f376199602cac",
  "assignee": null,
  "assignees": [],
  "milestone": null,
  "commits_url": "https://api.github.com/repos/line/armeria/pulls/507/commits",
  "review_comments_url": "https://api.github.com/repos/line/armeria/pulls/507/comments",
  "review_comment_url": "https://api.github.com/repos/line/armeria/pulls/comments{/number}",
  "comments_url": "https://api.github.com/repos/line/armeria/issues/507/comments",
  "statuses_url": "https://api.github.com/repos/line/armeria/statuses/d98685978be10493e89ce96e4ef7eda843e5a98e",
  "head": {
    "label": "trustin:more_convenient_construction",
    "ref": "more_convenient_construction",
    "sha": "d98685978be10493e89ce96e4ef7eda843e5a98e",
    "user": {
      "login": "trustin",
      "id": 173918,
      "avatar_url": "https://avatars3.githubusercontent.com/u/173918?v=3",
      "gravatar_id": "",
      "url": "https://api.github.com/users/trustin",
      "html_url": "https://github.com/trustin",
      "followers_url": "https://api.github.com/users/trustin/followers",
      "following_url": "https://api.github.com/users/trustin/following{/other_user}",
      "gists_url": "https://api.github.com/users/trustin/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/trustin/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/trustin/subscriptions",
      "organizations_url": "https://api.github.com/users/trustin/orgs",
      "repos_url": "https://api.github.com/users/trustin/repos",
      "events_url": "https://api.github.com/users/trustin/events{/privacy}",
      "received_events_url": "https://api.github.com/users/trustin/received_events",
      "type": "User",
      "site_admin": false
    },
    "repo": {
      "id": 46322160,
      "name": "armeria",
      "full_name": "trustin/armeria",
      "owner": {
        "login": "trustin",
        "id": 173918,
        "avatar_url": "https://avatars3.githubusercontent.com/u/173918?v=3",
        "gravatar_id": "",
        "url": "https://api.github.com/users/trustin",
        "html_url": "https://github.com/trustin",
        "followers_url": "https://api.github.com/users/trustin/followers",
        "following_url": "https://api.github.com/users/trustin/following{/other_user}",
        "gists_url": "https://api.github.com/users/trustin/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/trustin/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/trustin/subscriptions",
        "organizations_url": "https://api.github.com/users/trustin/orgs",
        "repos_url": "https://api.github.com/users/trustin/repos",
        "events_url": "https://api.github.com/users/trustin/events{/privacy}",
        "received_events_url": "https://api.github.com/users/trustin/received_events",
        "type": "User",
        "site_admin": false
      },
      "private": false,
      "html_url": "https://github.com/trustin/armeria",
      "description": "Asynchronous RPC/API client/server library built on top of Java 8, Netty 4.1, HTTP/2, and Thrift",
      "fork": true,
      "url": "https://api.github.com/repos/trustin/armeria",
      "forks_url": "https://api.github.com/repos/trustin/armeria/forks",
      "keys_url": "https://api.github.com/repos/trustin/armeria/keys{/key_id}",
      "collaborators_url": "https://api.github.com/repos/trustin/armeria/collaborators{/collaborator}",
      "teams_url": "https://api.github.com/repos/trustin/armeria/teams",
      "hooks_url": "https://api.github.com/repos/trustin/armeria/hooks",
      "issue_events_url": "https://api.github.com/repos/trustin/armeria/issues/events{/number}",
      "events_url": "https://api.github.com/repos/trustin/armeria/events",
      "assignees_url": "https://api.github.com/repos/trustin/armeria/assignees{/user}",
      "branches_url": "https://api.github.com/repos/trustin/armeria/branches{/branch}",
      "tags_url": "https://api.github.com/repos/trustin/armeria/tags",
      "blobs_url": "https://api.github.com/repos/trustin/armeria/git/blobs{/sha}",
      "git_tags_url": "https://api.github.com/repos/trustin/armeria/git/tags{/sha}",
      "git_refs_url": "https://api.github.com/repos/trustin/armeria/git/refs{/sha}",
      "trees_url": "https://api.github.com/repos/trustin/armeria/git/trees{/sha}",
      "statuses_url": "https://api.github.com/repos/trustin/armeria/statuses/{sha}",
      "languages_url": "https://api.github.com/repos/trustin/armeria/languages",
      "stargazers_url": "https://api.github.com/repos/trustin/armeria/stargazers",
      "contributors_url": "https://api.github.com/repos/trustin/armeria/contributors",
      "subscribers_url": "https://api.github.com/repos/trustin/armeria/subscribers",
      "subscription_url": "https://api.github.com/repos/trustin/armeria/subscription",
      "commits_url": "https://api.github.com/repos/trustin/armeria/commits{/sha}",
      "git_commits_url": "https://api.github.com/repos/trustin/armeria/git/commits{/sha}",
      "comments_url": "https://api.github.com/repos/trustin/armeria/comments{/number}",
      "issue_comment_url": "https://api.github.com/repos/trustin/armeria/issues/comments{/number}",
      "contents_url": "https://api.github.com/repos/trustin/armeria/contents/{+path}",
      "compare_url": "https://api.github.com/repos/trustin/armeria/compare/{base}...{head}",
      "merges_url": "https://api.github.com/repos/trustin/armeria/merges",
      "archive_url": "https://api.github.com/repos/trustin/armeria/{archive_format}{/ref}",
      "downloads_url": "https://api.github.com/repos/trustin/armeria/downloads",
      "issues_url": "https://api.github.com/repos/trustin/armeria/issues{/number}",
      "pulls_url": "https://api.github.com/repos/trustin/armeria/pulls{/number}",
      "milestones_url": "https://api.github.com/repos/trustin/armeria/milestones{/number}",
      "notifications_url": "https://api.github.com/repos/trustin/armeria/notifications{?since,all,participating}",
      "labels_url": "https://api.github.com/repos/trustin/armeria/labels{/name}",
      "releases_url": "https://api.github.com/repos/trustin/armeria/releases{/id}",
      "deployments_url": "https://api.github.com/repos/trustin/armeria/deployments",
      "created_at": "2015-11-17T03:59:08Z",
      "updated_at": "2017-01-10T02:20:41Z",
      "pushed_at": "2017-04-21T10:16:18Z",
      "git_url": "git://github.com/trustin/armeria.git",
      "ssh_url": "git@github.com:trustin/armeria.git",
      "clone_url": "https://github.com/trustin/armeria.git",
      "svn_url": "https://github.com/trustin/armeria",
      "homepage": "http://line.github.io/armeria/",
      "size": 20204,
      "stargazers_count": 3,
      "watchers_count": 3,
      "language": "Java",
      "has_issues": false,
      "has_projects": true,
      "has_downloads": true,
      "has_wiki": false,
      "has_pages": false,
      "forks_count": 4,
      "mirror_url": null,
      "open_issues_count": 0,
      "forks": 4,
      "open_issues": 0,
      "watchers": 3,
      "default_branch": "master"
    }
  },
  "base": {
    "label": "line:master",
    "ref": "master",
    "sha": "d98b2cf703cd1b3e669d7ce03f0d8e00cbf5521f",
    "user": {
      "login": "line",
      "id": 13128444,
      "avatar_url": "https://avatars1.githubusercontent.com/u/13128444?v=3",
      "gravatar_id": "",
      "url": "https://api.github.com/users/line",
      "html_url": "https://github.com/line",
      "followers_url": "https://api.github.com/users/line/followers",
      "following_url": "https://api.github.com/users/line/following{/other_user}",
      "gists_url": "https://api.github.com/users/line/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/line/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/line/subscriptions",
      "organizations_url": "https://api.github.com/users/line/orgs",
      "repos_url": "https://api.github.com/users/line/repos",
      "events_url": "https://api.github.com/users/line/events{/privacy}",
      "received_events_url": "https://api.github.com/users/line/received_events",
      "type": "Organization",
      "site_admin": false
    },
    "repo": {
      "id": 46251204,
      "name": "armeria",
      "full_name": "line/armeria",
      "owner": {
        "login": "line",
        "id": 13128444,
        "avatar_url": "https://avatars1.githubusercontent.com/u/13128444?v=3",
        "gravatar_id": "",
        "url": "https://api.github.com/users/line",
        "html_url": "https://github.com/line",
        "followers_url": "https://api.github.com/users/line/followers",
        "following_url": "https://api.github.com/users/line/following{/other_user}",
        "gists_url": "https://api.github.com/users/line/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/line/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/line/subscriptions",
        "organizations_url": "https://api.github.com/users/line/orgs",
        "repos_url": "https://api.github.com/users/line/repos",
        "events_url": "https://api.github.com/users/line/events{/privacy}",
        "received_events_url": "https://api.github.com/users/line/received_events",
        "type": "Organization",
        "site_admin": false
      },
      "private": false,
      "html_url": "https://github.com/line/armeria",
      "description": "Asynchronous RPC/API client/server library built on top of Java 8, Netty 4.1, HTTP/2, and Thrift",
      "fork": false,
      "url": "https://api.github.com/repos/line/armeria",
      "forks_url": "https://api.github.com/repos/line/armeria/forks",
      "keys_url": "https://api.github.com/repos/line/armeria/keys{/key_id}",
      "collaborators_url": "https://api.github.com/repos/line/armeria/collaborators{/collaborator}",
      "teams_url": "https://api.github.com/repos/line/armeria/teams",
      "hooks_url": "https://api.github.com/repos/line/armeria/hooks",
      "issue_events_url": "https://api.github.com/repos/line/armeria/issues/events{/number}",
      "events_url": "https://api.github.com/repos/line/armeria/events",
      "assignees_url": "https://api.github.com/repos/line/armeria/assignees{/user}",
      "branches_url": "https://api.github.com/repos/line/armeria/branches{/branch}",
      "tags_url": "https://api.github.com/repos/line/armeria/tags",
      "blobs_url": "https://api.github.com/repos/line/armeria/git/blobs{/sha}",
      "git_tags_url": "https://api.github.com/repos/line/armeria/git/tags{/sha}",
      "git_refs_url": "https://api.github.com/repos/line/armeria/git/refs{/sha}",
      "trees_url": "https://api.github.com/repos/line/armeria/git/trees{/sha}",
      "statuses_url": "https://api.github.com/repos/line/armeria/statuses/{sha}",
      "languages_url": "https://api.github.com/repos/line/armeria/languages",
      "stargazers_url": "https://api.github.com/repos/line/armeria/stargazers",
      "contributors_url": "https://api.github.com/repos/line/armeria/contributors",
      "subscribers_url": "https://api.github.com/repos/line/armeria/subscribers",
      "subscription_url": "https://api.github.com/repos/line/armeria/subscription",
      "commits_url": "https://api.github.com/repos/line/armeria/commits{/sha}",
      "git_commits_url": "https://api.github.com/repos/line/armeria/git/commits{/sha}",
      "comments_url": "https://api.github.com/repos/line/armeria/comments{/number}",
      "issue_comment_url": "https://api.github.com/repos/line/armeria/issues/comments{/number}",
      "contents_url": "https://api.github.com/repos/line/armeria/contents/{+path}",
      "compare_url": "https://api.github.com/repos/line/armeria/compare/{base}...{head}",
      "merges_url": "https://api.github.com/repos/line/armeria/merges",
      "archive_url": "https://api.github.com/repos/line/armeria/{archive_format}{/ref}",
      "downloads_url": "https://api.github.com/repos/line/armeria/downloads",
      "issues_url": "https://api.github.com/repos/line/armeria/issues{/number}",
      "pulls_url": "https://api.github.com/repos/line/armeria/pulls{/number}",
      "milestones_url": "https://api.github.com/repos/line/armeria/milestones{/number}",
      "notifications_url": "https://api.github.com/repos/line/armeria/notifications{?since,all,participating}",
      "labels_url": "https://api.github.com/repos/line/armeria/labels{/name}",
      "releases_url": "https://api.github.com/repos/line/armeria/releases{/id}",
      "deployments_url": "https://api.github.com/repos/line/armeria/deployments",
      "created_at": "2015-11-16T04:04:01Z",
      "updated_at": "2017-04-22T11:39:47Z",
      "pushed_at": "2017-04-23T07:16:21Z",
      "git_url": "git://github.com/line/armeria.git",
      "ssh_url": "git@github.com:line/armeria.git",
      "clone_url": "https://github.com/line/armeria.git",
      "svn_url": "https://github.com/line/armeria",
      "homepage": "http://line.github.io/armeria/",
      "size": 22886,
      "stargazers_count": 746,
      "watchers_count": 746,
      "language": "Java",
      "has_issues": true,
      "has_projects": true,
      "has_downloads": true,
      "has_wiki": false,
      "has_pages": true,
      "forks_count": 196,
      "mirror_url": null,
      "open_issues_count": 44,
      "forks": 196,
      "open_issues": 44,
      "watchers": 746,
      "default_branch": "master"
    }
  },
  "_links": {
    "self": {
      "href": "https://api.github.com/repos/line/armeria/pulls/507"
    },
    "html": {
      "href": "https://github.com/line/armeria/pull/507"
    },
    "issue": {
      "href": "https://api.github.com/repos/line/armeria/issues/507"
    },
    "comments": {
      "href": "https://api.github.com/repos/line/armeria/issues/507/comments"
    },
    "review_comments": {
      "href": "https://api.github.com/repos/line/armeria/pulls/507/comments"
    },
    "review_comment": {
      "href": "https://api.github.com/repos/line/armeria/pulls/comments{/number}"
    },
    "commits": {
      "href": "https://api.github.com/repos/line/armeria/pulls/507/commits"
    },
    "statuses": {
      "href": "https://api.github.com/repos/line/armeria/statuses/d98685978be10493e89ce96e4ef7eda843e5a98e"
    }
  },
  "merged": false,
  "mergeable": true,
  "rebaseable": true,
  "mergeable_state": "clean",
  "merged_by": null,
  "comments": 2,
  "review_comments": 4,
  "maintainer_can_modify": true,
  "commits": 1,
  "additions": 248,
  "deletions": 83,
  "changed_files": 10
}
